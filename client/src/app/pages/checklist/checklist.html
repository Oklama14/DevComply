<div class="page">
  <!-- Breadcrumb + bot√£o -->
  <div class="page-header">
    <nav class="breadcrumb">
      <a routerLink="/dashboard">Home</a>
      <span>‚Ä∫</span>
      <span>Checklist LGPD</span>
    </nav>

    <div class="title-row">
      <h1>Checklist LGPD</h1>
      <button class="btn btn-primary" (click)="generateReport()">
        <svg viewBox="0 0 24 24" width="16" height="16">
          <path d="M3 3h13l5 5v13a1 1 0 0 1-1 1H3zM16 3v6h6" fill="currentColor"></path>
        </svg>
        Gerar Relat√≥rio
      </button>
    </div>
  </div>

  <!-- Cart√£o do projeto -->
  <section class="project-card" *ngIf="project">
    <div class="project-title">Projeto: {{ project.nome }}</div>
    <p class="project-desc">{{ project.descricao }}</p>

    <div class="progress-row">
      <span>Progresso:</span> <strong>{{ overallProgress }}%</strong>
    </div>
    <div class="progressbar">
      <div class="progressbar-fill" [style.width.%]="overallProgress"></div>
    </div>
  </section>

  <!-- Estados -->
  <div *ngIf="isLoading" class="state muted">Carregando checklist‚Ä¶</div>
  <div *ngIf="!isLoading && (!checklistData || !checklistData.length)" class="state muted">
    Nenhuma pergunta encontrada.
  </div>

  <!-- Categorias -->
  <section *ngFor="let category of checklistData" class="category">
    <div class="category-header">
      <h2>{{ category.nome }}</h2>
      <span class="cat-progress">{{ category.progress || 0 }}% completo</span>
    </div>
    <div class="category-desc" *ngIf="category.descricao">{{ category.descricao }}</div>

    <div class="progressbar small">
      <div class="progressbar-fill" [style.width.%]="category.progress || 0"></div>
    </div>

    <!-- Itens -->
    <div class="items">
      <article *ngFor="let item of category.items"
               class="item"
               [class.item-completed]="item.completed">

        <!-- Cabe√ßalho do item -->
        <div class="item-head" (click)="toggleItemExpansion(item)">
          <div class="left">
            <input type="checkbox"
                   class="checkbox"
                   [(ngModel)]="item.completed"
                   (click)="$event.stopPropagation()" />

            <div class="title-wrap">
              <h3 class="q-title">{{ item.titulo }}</h3>
              <p class="q-sub" *ngIf="item.descricao">{{ item.descricao }}</p>
            </div>
          </div>

          <div class="right">
            <!-- Tooltip do prot√≥tipo: usa item.tipText (coluna 'dica') -->
            <div class="tooltip" *ngIf="item.tipText" (click)="$event.stopPropagation()">
              <button class="chip help" aria-label="Ver dica">?</button>
              <div class="tooltip-bubble">
                <strong>üí° Dica:</strong> {{ item.tipText }}
              </div>
            </div>

            <!-- Badge com refer√™ncia LGPD -->
            <span class="chip law" *ngIf="item.lgpdReference">{{ item.lgpdReference }}</span>

            <span class="chevron" [class.up]="item.expanded">‚åÑ</span>
          </div>
        </div>

        <!-- Corpo expandido -->
        <div class="item-body" *ngIf="item.expanded">
          <label class="field">
            <span>Explica√ß√£o da sua implementa√ß√£o:</span>
            <textarea [(ngModel)]="item.answer"
                      placeholder="Descreva como sua solu√ß√£o atende a este requisito..."></textarea>
          </label>

          <label class="field">
            <span>Detalhes t√©cnicos:</span>
            <textarea [(ngModel)]="item.technicalDetails"
                      placeholder="Tecnologias, m√©todos de criptografia, estruturas de BD, etc."></textarea>
          </label>
        </div>
      </article>
    </div>
  </section>

  <!-- Rodap√© -->
  <div class="footer-actions" *ngIf="!isLoading && checklistData?.length">
    <button class="btn btn-primary" (click)="generateReport()">Gerar Relat√≥rio</button>
    <button class="btn btn-secondary" (click)="saveProgress()">Salvar Progresso</button>
  </div>
</div>
